<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Document</title>
  <style>
    input {
        margin: 10px 0;
        padding: 5px;
    }
  </style>
</head>
<body>
  <!-- data binding start-->
  <div id="app1">
    value:<input type="text" value="joe" id="model" value=""><br>
    show value:<p id="view"></p>
  </div>
  <script>
    "use strict"
    function Pastry(conf) {
      this.data = conf.data;
      this.el = conf.el;
      this.init();
    }
    Pastry.prototype = {
      init: function (){
        
      }
    }



    var Joe = {name: ""};
    var m = document.getElementById("model");
    var v = document.getElementById("view");
    Object.defineProperty(Joe, "val", {
      set: function (value) {
        this.name = value;
        v.innerHTML = Joe.val;
      },
      get: function () {
        return this.name;
      },
      enumerable: true,
      configurable: true
    });
    m.addEventListener('input', function (e) {
      Joe.val = e.target.value;
      console.log(e);
    })
  </script>

  <!-- template engine start-->
  <div id="app">
    <p>hello world! {{ name }}, stay {{hungry}}, stay {{ foolish }}</p>
  </div>
</body>
<script>
  "use strict"
  // window.onbeforeunload = function (){
  //   return false;
  // }
  //
  let data = {
    name: "joe",
    hungry: "hungry",
    foolishs: "foolish"
  };

  let tpl = document.querySelector("#app").innerHTML;
  function render( tpl, data){
    const REG_RENDER = /{{([^}}]+)?}}/g;
    let new_tpl = tpl.replace(REG_RENDER, function(str){
      const REG_VAL_NAME = /[^}}|{{| ]+/g;
      let valueName = REG_VAL_NAME.exec(str)[0];
      if(data[valueName]){
        return data[valueName];
      }else{
        console.error("variable [" + valueName + "] is undefined in [data]");
        return "<strong style=\"color:red;\">["+valueName+"] undefined</strong>";
      }
    });
    return new_tpl;
  }




  // let match = "";
  // let re2 = /{{([^}}]+)?}}/g;
  // while(match = re2.exec(tpl)) {
  //     console.log(match);
  // }

  document.querySelector("#app").innerHTML = render(tpl, data);;
</script>
</html>
